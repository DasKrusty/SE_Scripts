@variables{
    * Abreviated names for blocks
    AIVE = "Air Vent Fan"
    ANTE = "Antenna"
    BATT = "Battery"
    BEAC = "Beacon"
    COMA = "Connector Main"
    COSE = "Connector Second"
    EVC2 = "Event Controller - Connect"
    EXPI = "Exhaust Pipe"
    GATU = "Gatling Turret"
    GYRO = "Gyroscope"
    HELI = "Headlight"
    HLL1 = "Hinge Landing Leg 1"
    HYEN = "Hydrogen Engine"
    HYTA = "Hydrogen Tank"
    LCIN = "LCD Info"
    LIGH = "Light"
    LIPA = "Light Panel Floor"
    LIST = "Light Status"
    O2H2 = "O2/H2 Generator"
    ORDE = "Ore Detector"
    PAHA = "Parachute Hatch"
    PRPA = "Program [PAM]"
    PIJA = "Piston Jack"
    ROAR = "Rotor Arm"
    ROLI = "Rotating Light"
    SPLI = "Spotlight"
    THRU = "Thruster"
    TISH = "Timer Shutdown"
    TIST = "Timer Standby"
    HILA = "Hinge Landing"
    HIL1 = "Hinge Landing One"
    HIL2 = "Hinge Landing Two"
    PILA = "Piston Landing"
    MALO = "Maglock" 
}

@low_alt{
    * Triggered by Event Controller checking Altitude
    OnOff_On \LIPA
    Write to \LCIN = "LOW ALTITUDE"
    Rotate \HIL1 to -30 at -3
    Delay 1000
    Rotate \HIL2 to -60 at -6
    Move \PILA to 1 at 1
}

@high_alt{
    * Triggered by Event Controller checking Altitude
    OnOff_Off \LIPA
    Rotate \HILA to -85 at 1
    Move \PILA to 0 at -1
    Write to \LCIN = "HIGH ALTITUDE"
}

@land{
    * Triggered by Event Controller checking if Maglock ready to lock
    Delay 3000
    if UCA-11 Maglock BL = READY TO LOCK {
        Lock \MALO
        @runmode
    }
}

@runmode {
    if Color of \LIST = 255:0:0
    {
        @offlinetostandby
    }
    else if Color of \LIST = 255:255:0
    {
        @standbytoonline
    }
    else if Color of \LIST = 255:255:255
    {
        @onlinetostandby
    }
    else if Color of \LIST = 255:255:50
    {
        @standbytooffline
    }
}

@offlinetostandby {
    Color of \LIST = 255:255:0
    Write to \LCIN = Standby
    OnOff_On \AIVE
    Delay 1000
    Write to \LCIN = Comms Systems Up
    OnOff_On \ANTE
    OnOff_On \ORDE
    Delay 1000
    Write to \LCIN = Light Systems Up
    OnOff_On \LIGH
    OnOff_On \LIPA
    OnOff_On \O2H2
    
}

@standbytoonline {
    Color of \LIST = 255:255:255
    Write to \LCIN = Active
    OnOff_Off \EVC2
    Delay 1000
    Write to \LCIN = Power Systems Up
    Discharge \BATT
    Stockpile of \HYTA = False
    Delay 1000
    if UCG-11 Connector Main = Connected {
        Delay 1000
        Write to \LCIN = Unlocking Back Connector
        Unlock \COMA
    }
        if UCG-11 Connector Second = Connected {
        Delay 1000
        Write to \LCIN = Unlocking Down Connector
        Unlock \COSE
    }
    Delay 1000
    Write to \LCIN = Flight Systems Up
    OnOff_On \GYRO
    OnOff_On \THRU
    Delay 5000
    OnOff_On \EVC2
    Stop \TIST
    Stop \TISH
}

@onlinetostandby {
    Color of \LIST = 255:255:50
    Write to \LCIN = Standby
    OnOff_Off \AIVE
    Delay 1000
    Write to \LCIN = Flight Systems Down
    OnOff_Off \GYRO
    OnOff_Off \THRU
    OnOff_Off \LIPA
    Start \TISH
}

@standbytooffline {
    Color of \LIST = 255:0:0
    Delay 1000
    Write to \LCIN = Comms Systems Down
    OnOff_Off \ANTE
    OnOff_Off \ORDE
    Delay 1000
    Write to \LCIN = Checking Connection
    if UCG-11 Connector Main = Connected {
        Recharge \BATT
        Stockpile of \HYTA = True
        Delay 1000
        Write to \LCIN = Recharging Batteries
    }
        if UCG-11 Connector Second = Connected {
        Recharge \BATT
        Stockpile of \HYTA = True
        Delay 1000
        Write to \LCIN = Recharging Batteries
    }
    Delay 1000
    Write to \LCIN = Light Systems Down
    OnOff_Off \LIGH
    OnOff_Off \O2H2
    Delay 1000
    Write to \LCIN = Powered Down
}