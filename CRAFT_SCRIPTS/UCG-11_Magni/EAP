@variables{
    * Abreviated names for blocks
    AIVE = "Air Vent Fan"
    ANTE = "Antenna"
    BATT = "Battery"
    BEAC = "Beacon"
    COMA = "Connector Main"
    COSE = "Connector Second"
    EVC2 = "Event Controller - Connect"
    EVC3 = "Event Controller - Land"
    EVC4 = "Event Controller - Cockpit"
    EXPI = "Exhaust Pipe"
    GATU = "Gatling Turret"
    GYRO = "Gyroscope"
    HELI = "Headlight"
    HLL1 = "Hinge Landing Leg 1"
    HYEN = "Hydrogen Engine"
    HYTA = "Hydrogen Tank"
    LCIN = "LCD Info"
    LIGH = "Light"
    LIPA = "Light Panel Floor"
    LIST = "Light Status"
    O2H2 = "O2/H2 Generator"
    ORDE = "Ore Detector"
    PAHA = "Parachute Hatch"
    PRPA = "Program [PAM]"
    PIJA = "Piston Jack"
    ROAR = "Rotor Arm"
    ROLI = "Rotating Light"
    SPLI = "Spotlight"
    THRU = "Thruster"
    TISH = "Timer Shutdown"
    TIST = "Timer Standby"
    HILA = "Hinge Landing"
    HIL1 = "Hinge Landing One"
    HIL2 = "Hinge Landing Two"
    PILA = "Piston Landing"
    MALO = "Maglock" 
}

@low_alt{
    * Triggered by Event Controller checking Altitude
    OnOff_On \LIPA
    Write to \LCIN = "LOW ALTITUDE"
    Rotate \HIL1 to 45 at 3
    Delay 1000
    Rotate \HIL2 to 45 at 6
    Move \PILA to 1 at 1
    OnOff_On \EVC3
}

@high_alt{
    * Triggered by Event Controller checking Altitude
    OnOff_Off \LIPA
    Write to \LCIN = "HIGH ALTITUDE"
    Rotate \HIL1 to 1 at 1
    Rotate \HIL2 to -1 at 1
    Move \PILA to 0 at 1
    OnOff_Off \EVC3
    OnOff_Off \EVC4
}

@land{
    * Triggered by Event Controller checking if Maglock ready to lock
    Color of \LIPA = 255:255:0
    Write to \LCIN = "Ready to Land"
    Delay 5000
    if Status of UCA-11 Maglock BL = ReadyToLock {
        WriteLine to \LCIN = "Mags Locked"
        Color of \LIPA = 0:255:0
        Lock \MALO
        Delay 3000
        OnOff_Off \EVC3
        Color of \LIPA = 255:255:255
    }
    OnOff_On \EVC4
}

@land_no{
    * Triggered by Event Controller checking if Maglock ready to lock
    Color of \LIPA = 255:255:255
    Write to \LCIN = "Not Ready to Land"
}

@launch{
    * Triggered by selection from menu
    Write to \LCIN = "PREPPING LAUNCH"
    @standbytoonline
    OnOff_Off \EVC3
    Delay 1000
    WriteLine to \LCIN = "Mags Unlocked"
    Unlock \MALO
}

@runmode{
    if Color of UCA-11 Light Status = 255:0:0
    {
        @offlinetostandby
    }
    else if Color of UCA-11 Light Status = 255:255:0
    {
        @standbytoonline
    }
    else if Color of UCA-11 Light Status = 255:255:255
    {
        @onlinetostandby
    }
    else if Color of UCA-11 Light Status = 255:255:50
    {
        @standbytooffline
    }
}

@offlinetostandby{
    Write to \LCIN = "Running"
    Delay 1000
    WriteLine to \LCIN = "Power Sys ON"
    Discharge \BATT
    Stockpile of \HYTA = False
    OnOff_On \O2H2
    Delay 1000
    WriteLine to \LCIN = "Support Sys ON"
    Stop \TISH
    Stop \TIST
    OnOff_On \AIVE
    OnOff_On \LIGH
    Delay 1000
    WriteLine to \LCIN = "Comms Sys ON"
    OnOff_On \ANTE
    OnOff_On \ORDE
    Delay 1000
    Color of \LIST = 255:255:0
    Write to \LCIN = "Standby"
}

@standbytoonline{
    Write to \LCIN = "Running"
    Stop \TISH
    Delay 1000
    WriteLine to \LCIN = "Flight Sys ON"
    OnOff_On \GYRO
    OnOff_On \THRU
    Delay 1000
    Color of \LIST = 255:255:255
    Write to \LCIN = "Active"
}

@onlinetostandby{
    Write to \LCIN = "Running"
    Delay 1000
    WriteLine to \LCIN = "Flight Sys OFF"
    OnOff_Off \GYRO
    OnOff_Off \THRU
    Delay 1000
    WriteLine to \LCIN = "Support Sys OFF"
    OnOff_Off \AIVE
    Delay 1000
    Color of \LIST = 255:255:50
    Write to \LCIN = "Standby"
}

@standbytooffline{
    Write to \LCIN = "Running"
    Delay 1000
    WriteLine to \LCIN = "Comms Sys OFF"
    OnOff_Off \ANTE
    OnOff_Off \ORDE
    WriteLine to \LCIN = "Checking Connection Status"
    Delay 1000
    if UCA-11 Connector Main = Connected {
        Delay 1000
        WriteLine to \LCIN = "Power Sys OFF"
        Discharge \BATT
        Stockpile of \HYTA = True
        OnOff_Off \O2H2
        Delay 1000
        WriteLine to \LCIN = "Connection Good"
    }
    if UCA-11 Connector Second = Connected {
        Delay 1000
        WriteLine to \LCIN = "Power Sys OFF"
        Discharge \BATT
        Stockpile of \HYTA = True
        OnOff_Off \O2H2
        Delay 1000
        WriteLine to \LCIN = "Connection Good"
    }
    Delay 1000
    OnOff_Off \LIGH
    OnOff_Off \SPLI
    Color of \LIST = 255:0:0
    Write to \LCIN = "Powered Down"
}