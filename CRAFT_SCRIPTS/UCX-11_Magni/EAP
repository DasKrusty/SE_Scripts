@variables{
    * Abreviated names for blocks
    AIVE = "Air Vent Fan"
    ANTE = "Antenna"
    BATT = "Battery"
    BEAC = "Beacon"
    COLA = "Connector Landing"
    COMA = "Connector Main"
    COSE = "Connector Second"
    EVC2 = "Event Controller - Connect"
    EVC3 = "Event Controller - Land"
    EVC4 = "Event Controller - Cockpit"
    EXPI = "Exhaust Pipe"
    GATU = "Gatling Turret"
    GYRO = "Gyroscope"
    HELI = "Headlight"
    HILA = "Hinge Landing"
    HIL1 = "Hinge Landing One"
    HIL2 = "Hinge Landing Two"
    HLL1 = "Hinge Landing Leg 1"
    HYEN = "Hydrogen Engine"
    HYTA = "Hydrogen Tank"
    LCIN = "LCD Info"
    LIGH = "Light"
    LIPA = "Light Panel Floor"
    LIST = "Light Status"
    MALO = "Maglock"
    MAFR = "Maglock FR"
    MAFL = "Maglock FL"
    MABR = "Maglock BR"
    MABL = "Maglock BL"
    MEBL = "Merge Landing Block"
    O2H2 = "O2/H2 Generator"
    ORDE = "Ore Detector"
    PAHA = "Parachute Hatch"
    PILA = "Piston Landing"
    PIFR = "Piston Landing FR"
    PIFL = "Piston Landing FL"
    PIBR = "Piston Landing BR"
    PIBL = "Piston Landing BL"
    PRPA = "Program [PAM]"
    PIJA = "Piston Jack"
    ROAR = "Rotor Arm"
    ROLI = "Rotating Light"
    SPLI = "Spotlight"
    THRU = "Thruster"
    TISH = "Timer Shutdown"
    TIST = "Timer Standby"
}

@pickup_toggle{
    if Status of UCX-11 Maglock FR = Locked {
        @pickup_drop
    }
    else if Status of UCX-11 Maglock FR = Unlocked {
        @pickup_lock
    }
}

@pickup_drop{
    * Safety - if landed dont do anything
    OnOff_On \EVC2
    OnOff_On \EVC3
    OnOff_On \EVC4
    OnOff_Off \LIPA
    Write to \LCIN = "Dropping Pickup"
    Delay 1000
    Unlock \MALO
    Write to \LCIN = "Pickup Done"
}

@pickup_lock{
    * Safety - if landed dont do anything
    OnOff_Off \EVC2
    OnOff_Off \EVC3
    OnOff_Off \EVC4
    OnOff_On \LIPA
    Write to \LCIN = "Pick Up Setting Up"
    Rotate \HIL1 to 85 at 3
    Delay 1000
    Rotate \HIL2 to 80 at 4
    Delay 5000
    WriteLine to \LCIN = "Deploying Arms"
    Move \PIFR to 2 at 4
    Delay 1000
    Move \PIFL to 2 at 3
    Delay 1000
    Move \PIBR to 2 at 2
    Delay 1000
    Move \PIBL to 2 at 1
    When Status of UCX-11 Maglock FR = ReadyToLock {
        Velocity of \PIFR = 0
        Lock \MAFR
        WriteLine to \LCIN = "Maglock FR Locked"
    }
    When Status of UCX-11 Maglock FL = ReadyToLock {
        Velocity of \PIFL = 0
        Lock \MAFL
        WriteLine to \LCIN = "Maglock FL Locked"
    }
    When Status of UCX-11 Maglock BR = ReadyToLock {
        Velocity of \PIBR = 0
        Lock \MABR
        WriteLine to \LCIN = "Maglock BR Locked"
    }
    When Status of UCX-11 Maglock BL = ReadyToLock {
        Velocity of \PIBL = 0
        Lock \MABL
        WriteLine to \LCIN = "Maglock BL Locked"
    }
    Delay 1000
    WriteLine to \LCIN = "All Mags Locked"
    Delay 1000
    Write to \LCIN = "Pick Up Good"
}

@module_toggle{
    * Safety - if landed dont do anything
    if Status of UCX-11 Connector Landing Front = Locked {
        @module_release
    }
    else if Status of UCX-11 Connector Landing Front = Unlocked {
        @module_lock
    }
}

@module_lock{
    * Safety - if landed dont do anything
    * Triggered by Menu
    Write to \LCIN = "Module Mode Activated"
    if Status of UCX-11 Maglock BL= Locked {
        Delay 1000
        WriteLine to \LCIN = "ERROR... Check Maglocks"
    }
    else if Status of UCX-11 Maglock BL = Unlocked {
        OnOff_Off \EVC2
        OnOff_Off \EVC3
        OnOff_Off \EVC4
        OnOff_On \LIPA
        Rotate \HIL1 to 45 at 1
        Delay 1000
        Rotate \HIL2 to -45 at 2
        Move \PILA to 2 at 1
        Delay 3000
        if Status of UCX-11 Connector Landing Front = ReadyToLock {
            OnOff_On \MEBL
            Delay 1000
            Lock \COLA
            Color of \LIST = 128:0:128
            WriteLine to \LCIN = "Module Good"
        }
        Delay 1000
        Rotate \HIL1 to 5 at 1
        Rotate \HIL2 to -90 at 1
        Move \PILA to 0 at 0.1
        WriteLine to \LCIN = "Module Secured"
    }
}

@module_release{
    Write to \LCIN = "Module Drop Prepping"
    Rotate \HIL1 to 45 at 1
    Delay 1000
    Rotate \HIL2 to -45 at 1
    Move \PILA to 2 at 1
    Delay 5000
    OnOff_Off \MEBL
    Delay 1000
    Unlock \COLA
    Color of \LIST = 0:255:0
    WriteLine to \LCIN = "Module Released"
    Delay 1000
    Color of \LIST = 255:255:255
    Rotate \HIL1 to 1 at 1
    Rotate \HIL2 to -1 at 1
    Move \PILA to 0 at 1
    OnOff_On \EVC2
    OnOff_On \EVC3
    OnOff_On \EVC4
    OnOff_Off \LIPA
}

@low_alt{
    * Triggered by Event Controller checking Altitude
    OnOff_On \LIPA
    Write to \LCIN = "LOW ALTITUDE"
    Rotate \HIL1 to 45 at 3
    Delay 1000
    Rotate \HIL2 to 45 at 6
    Move \PILA to 1 at 1
    OnOff_On \EVC3
}

@high_alt{
    * Triggered by Event Controller checking Altitude
    OnOff_Off \LIPA
    Write to \LCIN = "HIGH ALTITUDE"
    Rotate \HIL1 to 1 at 1
    Rotate \HIL2 to -1 at 1
    Move \PILA to 0 at 1
    OnOff_Off \EVC3
    OnOff_Off \EVC4
    OnOff_On \EVC2
}

@land{
    * Triggered by Event Controller checking if Maglock ready to lock
    Color of \LIPA = 255:255:0
    Write to \LCIN = "Ready to Land"
    Damp of MyShip = False
    Delay 5000
    if Status of UCX-11 Maglock BL = ReadyToLock {
        WriteLine to \LCIN = "Mags Locked"
        Color of \LIPA = 0:255:0
        Lock \MALO
        Delay 3000
        OnOff_Off \EVC3
        Color of \LIPA = 255:255:255
    }
    OnOff_On \EVC4
}

@land_no{
    * Triggered by Event Controller checking if Maglock ready to lock
    Color of \LIPA = 255:255:255
    Write to \LCIN = "Not Ready to Land"
}

@connect {
    * Uses Event Controller to trigger auto lock of Connector Main
    Write to \LCIN = "CONNECTING"
    Color of \LIGH = 255:255:0
    Blink Interval of \LIGH = 1
    Delay 3000
    If Status of UMG-6 Connector Main = Connectable {
        Write to \LCIN = "CONNECTED"
        Lock \COMA
        Delay 2000
        Blink Interval of \LIGH = 0
        Color of \LIGH = 250:250:255
        Delay 500
        Color of \LIST = 255:255:255
        Recharge \BATT
        Stockpile of \HYTA = True
    }
    OnOff_Off \EVC2
}

@launch{
    * Triggered by selection from menu
    Write to \LCIN = "PREPPING LAUNCH"
    @standbytoonline
    OnOff_Off \EVC3
    Delay 1000
    WriteLine to \LCIN = "Mags Unlocked"
    Unlock \MALO
}

@runmode{
    if Color of UCX-11 Light Status = 255:0:0
    {
        @offlinetostandby
    }
    else if Color of UCX-11 Light Status = 255:255:0
    {
        @standbytoonline
    }
    else if Color of UCX-11 Light Status = 255:255:255
    {
        @onlinetostandby
    }
    else if Color of UCX-11 Light Status = 255:255:50
    {
        @standbytooffline
    }
}

@offlinetostandby{
    Write to \LCIN = "Running"
    Delay 1000
    WriteLine to \LCIN = "Power Sys ON"
    Discharge \BATT
    Stockpile of \HYTA = False
    OnOff_On \O2H2
    Delay 1000
    WriteLine to \LCIN = "Support Sys ON"
    Stop \TISH
    Stop \TIST
    OnOff_On \AIVE
    OnOff_On \LIGH
    Delay 1000
    WriteLine to \LCIN = "Comms Sys ON"
    OnOff_On \ANTE
    OnOff_On \ORDE
    Delay 1000
    Color of \LIST = 255:255:0
    Write to \LCIN = "Standby"
}

@standbytoonline{
    Write to \LCIN = "Running"
    Stop \TISH
    Delay 1000
    WriteLine to \LCIN = "Flight Sys ON"
    OnOff_On \GYRO
    OnOff_On \THRU
    Delay 1000
    Color of \LIST = 255:255:255
    Write to \LCIN = "Active"
}

@onlinetostandby{
    Write to \LCIN = "Running"
    Delay 1000
    WriteLine to \LCIN = "Flight Sys OFF"
    OnOff_Off \GYRO
    OnOff_Off \THRU
    Delay 1000
    WriteLine to \LCIN = "Support Sys OFF"
    OnOff_Off \AIVE
    Delay 1000
    Color of \LIST = 255:255:50
    Write to \LCIN = "Standby"
}

@standbytooffline{
    Write to \LCIN = "Running"
    Delay 1000
    WriteLine to \LCIN = "Comms Sys OFF"
    OnOff_Off \ANTE
    OnOff_Off \ORDE
    WriteLine to \LCIN = "Checking Connection Status"
    Delay 1000
    if UCX-11 Connector Main = Connected {
        Delay 1000
        WriteLine to \LCIN = "Power Sys OFF"
        Discharge \BATT
        Stockpile of \HYTA = True
        OnOff_Off \O2H2
        Delay 1000
        WriteLine to \LCIN = "Connection Good"
    }
    if UCX-11 Connector Second = Connected {
        Delay 1000
        WriteLine to \LCIN = "Power Sys OFF"
        Discharge \BATT
        Stockpile of \HYTA = True
        OnOff_Off \O2H2
        Delay 1000
        WriteLine to \LCIN = "Connection Good"
    }
    Delay 1000
    OnOff_Off \LIGH
    OnOff_Off \SPLI
    Color of \LIST = 255:0:0
    Write to \LCIN = "Powered Down"
}

@info {
    Write to \LCIN = EAP - V.1.07
    WriteLine to \LCIN = FSD - V1.00
    WriteLine to \LCIN = SDS - V1.00
    WriteLine to \LCIN = Craft - V1.00
}